#include "CubePrimitive.h"

RENDERER_NAMESPACE_BEGIN

CubePrimitive::CubePrimitive(float size, bool colored) {
    generateCube(size, colored);
}

void CubePrimitive::generateCube(float size, bool colored) {
    float s = size * 0.5f;
    
    std::vector<Vertex> vertices = {
        // 前面 (z = -s)
        {{-s, -s, -s}, {1.0f, 0.0f, 0.0f}, {0.0f, 0.0f, -1.0f}, {0.0f, 0.0f}},
        {{ s, -s, -s}, {0.0f, 1.0f, 0.0f}, {0.0f, 0.0f, -1.0f}, {1.0f, 0.0f}},
        {{ s,  s, -s}, {0.0f, 0.0f, 1.0f}, {0.0f, 0.0f, -1.0f}, {1.0f, 1.0f}},
        {{-s,  s, -s}, {1.0f, 1.0f, 0.0f}, {0.0f, 0.0f, -1.0f}, {0.0f, 1.0f}},
        
        // 后面 (z = s)
        {{-s, -s,  s}, {1.0f, 0.0f, 1.0f}, {0.0f, 0.0f, 1.0f}, {0.0f, 0.0f}},
        {{ s, -s,  s}, {0.0f, 1.0f, 1.0f}, {0.0f, 0.0f, 1.0f}, {1.0f, 0.0f}},
        {{ s,  s,  s}, {1.0f, 1.0f, 1.0f}, {0.0f, 0.0f, 1.0f}, {1.0f, 1.0f}},
        {{-s,  s,  s}, {0.5f, 0.5f, 0.5f}, {0.0f, 0.0f, 1.0f}, {0.0f, 1.0f}},
        
        // 左面 (x = -s)
        {{-s, -s, -s}, {1.0f, 0.0f, 0.0f}, {-1.0f, 0.0f, 0.0f}, {0.0f, 0.0f}},
        {{-s,  s, -s}, {0.0f, 1.0f, 0.0f}, {-1.0f, 0.0f, 0.0f}, {1.0f, 0.0f}},
        {{-s,  s,  s}, {0.0f, 0.0f, 1.0f}, {-1.0f, 0.0f, 0.0f}, {1.0f, 1.0f}},
        {{-s, -s,  s}, {1.0f, 1.0f, 0.0f}, {-1.0f, 0.0f, 0.0f}, {0.0f, 1.0f}},
        
        // 右面 (x = s)
        {{ s, -s, -s}, {1.0f, 0.0f, 1.0f}, {1.0f, 0.0f, 0.0f}, {0.0f, 0.0f}},
        {{ s,  s, -s}, {0.0f, 1.0f, 1.0f}, {1.0f, 0.0f, 0.0f}, {1.0f, 0.0f}},
        {{ s,  s,  s}, {1.0f, 1.0f, 1.0f}, {1.0f, 0.0f, 0.0f}, {1.0f, 1.0f}},
        {{ s, -s,  s}, {0.5f, 0.5f, 0.5f}, {1.0f, 0.0f, 0.0f}, {0.0f, 1.0f}},
        
        // 底面 (y = -s)
        {{-s, -s, -s}, {1.0f, 0.0f, 0.0f}, {0.0f, -1.0f, 0.0f}, {0.0f, 0.0f}},
        {{ s, -s, -s}, {0.0f, 1.0f, 0.0f}, {0.0f, -1.0f, 0.0f}, {1.0f, 0.0f}},
        {{ s, -s,  s}, {0.0f, 0.0f, 1.0f}, {0.0f, -1.0f, 0.0f}, {1.0f, 1.0f}},
        {{-s, -s,  s}, {1.0f, 1.0f, 0.0f}, {0.0f, -1.0f, 0.0f}, {0.0f, 1.0f}},
        
        // 顶面 (y = s)
        {{-s,  s, -s}, {1.0f, 0.0f, 1.0f}, {0.0f, 1.0f, 0.0f}, {0.0f, 0.0f}},
        {{ s,  s, -s}, {0.0f, 1.0f, 1.0f}, {0.0f, 1.0f, 0.0f}, {1.0f, 0.0f}},
        {{ s,  s,  s}, {1.0f, 1.0f, 1.0f}, {0.0f, 1.0f, 0.0f}, {1.0f, 1.0f}},
        {{-s,  s,  s}, {0.5f, 0.5f, 0.5f}, {0.0f, 1.0f, 0.0f}, {0.0f, 1.0f}},
    };
    
    // 如果不需要彩色，统一设置为白色
    if (!colored) {
        for (auto& v : vertices) {
            v.color[0] = v.color[1] = v.color[2] = 1.0f;
        }
    }
    
    std::vector<unsigned int> indices = {
        0,  2,  1,  0,  3,  2,   // 前面
        4,  5,  6,  4,  6,  7,   // 后面
        8,  10,  9,  8,  11, 10,   // 左面
        12, 13, 14, 12, 14, 15,  // 右面
        16, 17, 18, 16, 18, 19,  // 底面
        20, 22, 21, 20, 23, 22   // 顶面
    };

    // std::vector<unsigned int> indices = {
    //     // 前面 - 逆时针 ✓
    //     0, 2, 1,  0, 3, 2,
    //     // 后面 - 逆时针 ✓  
    //     4, 6, 5,  4, 7, 6,
    //     // 左面 - 修正为逆时针
    //     8, 10, 9,  8, 11, 10,
    //     // 右面 - 逆时针 ✓
    //     12, 14, 13, 12, 15, 14,
    //     // 底面 - 逆时针 ✓
    //     16, 18, 17, 16, 19, 18,
    //     // 顶面 - 逆时针 ✓
    //     20, 22, 21, 20, 23, 22
    // };
    
    setupBuffers(vertices, indices);
}

RENDERER_NAMESPACE_END